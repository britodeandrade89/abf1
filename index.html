<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ABFIT</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#111827">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ABFIT">
    <link rel="apple-touch-icon" href="https://via.placeholder.com/192x192/991b1b/FFFFFF?text=AB">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@700&display=swap" rel="stylesheet">
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Leaflet.js for GPS Tracking -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- CRITICAL: Process Polyfill for GenAI SDK -->
    <script>
        window.process = {
            env: {
                NODE_ENV: 'production'
            }
        };
    </script>

    <link rel="stylesheet" href="index.css">
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.26.0",
    "@capacitor/cli": "https://aistudiocdn.com/@capacitor/cli@^7.4.4"
  }
}
</script>
</head>

<body class="overscroll-none">

    <!-- ======================= SPLASH SCREEN ======================= -->
    <div id="splashScreen" class="w-full h-screen flex flex-col items-center justify-center bg-black z-50 fixed inset-0 transition-opacity duration-500">
        <div class="p-6 flex flex-col items-center">
            <div class="inline-flex flex-col items-center">
                <h1 class="abfit-logo-style text-8xl mb-0 leading-none">
                    <span class="part-ab">AB</span><span class="part-fit">FIT</span>
                </h1>
                <p class="font-['Inter'] font-black italic text-white text-[10px] uppercase text-center mt-0 leading-none tracking-normal opacity-90">
                    Assessoria em Treinamentos Físicos
                </p>
            </div>
        </div>
        <div class="absolute bottom-8 text-center">
            <p class="text-gray-400 text-sm">Desenvolvido por André Brito</p>
            <p class="text-gray-500 text-xs mt-1">Versão 1.6</p>
        </div>
    </div>

    <!-- ======================= PWA INSTALL BANNER ======================= -->
    <div id="pwa-install-banner" class="hidden fixed bottom-0 left-0 right-0 z-[60] bg-gray-900 border-t-2 border-red-600 p-4 shadow-2xl transition-transform duration-300 transform translate-y-0">
        <div class="flex items-center justify-between max-w-lg mx-auto">
             <div class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-red-600 to-red-800 text-white font-black p-2 rounded-lg shadow-lg border border-red-500">AB</div>
                <div>
                    <h4 class="font-bold text-white text-sm">Instalar App ABFIT</h4>
                    <p class="text-xs text-gray-400">Acesso rápido na tela inicial</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button id="pwa-install-btn" class="bg-white text-black font-bold text-xs py-2 px-3 rounded-lg hover:bg-gray-200 transition shadow-md">
                    Instalar
                </button>
                <button id="pwa-close-btn" class="text-gray-400 hover:text-white p-1">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- ======================= APP CONTAINER ======================= -->
    <div id="appContainer" class="hidden init-hidden h-screen flex flex-col max-w-lg mx-auto relative">
        <main class="flex-grow screens-wrapper">
             <!-- ======================= TELA DE LOGIN ======================= -->
            <div id="loginScreen" class="screen">
                <div class="h-full flex flex-col justify-center p-6">
                    <div class="text-center mb-10 w-full">
                        <div class="inline-flex flex-col items-center">
                            <h1 class="abfit-logo-style text-7xl mb-0 leading-none">
                                <span class="part-ab">AB</span><span class="part-fit">FIT</span>
                            </h1>
                             <p class="font-['Inter'] font-black italic text-gray-400 text-[9px] uppercase text-center mt-0 leading-none tracking-normal">
                                Assessoria em Treinamentos Físicos
                            </p>
                        </div>
                    </div>

                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-xl">
                        <h3 class="text-white font-bold text-xl mb-4 text-left">Acesse seu Perfil</h3>
                        <form id="login-form">
                            <div class="mb-4">
                                <label for="login-email" class="block text-sm font-medium text-white mb-1">Email</label>
                                <input type="email" id="login-email" required placeholder="seuemail@exemplo.com"
                                    class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg focus:ring-red-500 focus:border-red-500">
                            </div>
                            <button id="login-btn" type="submit"
                                class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl flex items-center justify-center space-x-2 transition shadow-lg shadow-red-500/20">
                                Entrar
                            </button>
                            <div id="login-error" class="text-red-500 text-center text-sm mt-3 h-4"></div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ======================= TELA PERFIL DO ALUNO ======================= -->
            <div id="studentProfileScreen" class="screen p-6">
                <!-- Header Organizado -->
                <header class="flex flex-col pt-6 pb-2">
                    
                    <!-- Linha Superior: Logo ESQUERDA + Clima à DIREITA -->
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex-none animate-logo-entry flex flex-col items-start">
                            <h1 class="abfit-logo-style text-5xl leading-none">
                                <span class="part-ab">AB</span><span class="part-fit">FIT</span>
                            </h1>
                        </div>

                        <div class="flex-1 flex flex-col items-end">
                             <div id="weather-widget" class="text-right flex flex-col items-end min-h-[50px] justify-center">
                                <span class="text-xs text-gray-500">Carregando...</span>
                            </div>
                             <button id="logout-btn" class="mt-2 p-1 rounded-full hover:bg-gray-700 text-gray-400 hover:text-white border border-transparent hover:border-gray-600">
                                <i data-feather="log-out" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Faixa de Informações do Aluno -->
                    <div id="student-profile-info" class="hidden bg-gray-800/80 backdrop-blur-md border border-gray-700 rounded-xl p-4 flex items-center gap-4 shadow-lg"></div>

                </header>

                <div id="student-profile-buttons" class="grid grid-cols-3 gap-4 mb-6 mt-4"></div>

                <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg">
                    <div id="calendar-header" class="flex justify-between items-center mb-4">
                        <button id="prev-month-btn" class="p-2 rounded-full hover:bg-gray-700"><i
                                data-feather="chevron-left" class="text-white"></i></button>
                        <h2 id="calendar-month-year" class="font-bold text-lg text-white">Carregando...</h2>
                        <button id="next-month-btn" class="p-2 rounded-full hover:bg-gray-700"><i
                                data-feather="chevron-right" class="text-white"></i></button>
                    </div>
                    <div class="grid grid-cols-7 gap-1 text-center text-xs text-white mb-2">
                        <div>D</div>
                        <div>S</div>
                        <div>T</div>
                        <div>Q</div>
                        <div>Q</div>
                        <div>S</div>
                        <div>S</div>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center text-sm"></div>
                </div>

                <div id="training-history-container" class="mt-6"></div>
                
                <!-- FOOTER DETALHADO -->
                <footer class="mt-10 pb-24 pt-6 border-t border-gray-800 bg-transparent rounded-t-3xl -mx-6 px-6">
                    <div class="grid grid-cols-2 gap-y-6 gap-x-4 mb-6">
                        <div>
                            <h4 class="text-white font-bold text-xs mb-3 uppercase tracking-wider text-red-500">ABFIT</h4>
                            <ul class="space-y-2">
                                <li><a href="#" class="text-gray-500 text-[10px] hover:text-white transition-colors">Sobre nós</a></li>
                                <li><a href="#" class="text-gray-500 text-[10px] hover:text-white transition-colors">Carreiras</a></li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-white font-bold text-xs mb-3 uppercase tracking-wider text-red-500">Ajuda</h4>
                            <ul class="space-y-2">
                                <li><a href="#" class="text-gray-500 text-[10px] hover:text-white transition-colors">Fale Conosco</a></li>
                                <li><a href="#" class="text-gray-500 text-[10px] hover:text-white transition-colors">Suporte</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-800 pt-6">
                        <div class="flex flex-col text-center space-y-4">
                            <div class="text-[10px] text-gray-500 space-y-1">
                                <p class="text-gray-300 font-medium">Desenvolvido por: <span class="text-white font-bold">André Brito</span></p>
                                <p class="text-gray-600">Versão: 1.6</p>
                            </div>
                            <p class="text-[10px] text-gray-700 mt-2">© 2025 ABFIT Inc.</p>
                        </div>
                    </div>
                </footer>
            </div>

            <!-- ======================= TELA DE TREINO ======================= -->
            <div id="trainingScreen" class="screen p-6">
                <header class="flex items-center justify-between pt-6 pb-4 relative">
                    <button class="back-btn p-2 rounded-full hover:bg-gray-800 relative z-10" data-target="studentProfileScreen"><i
                            data-feather="arrow-left" class="text-white"></i></button>
                    
                    <div class="absolute inset-x-0 top-6 flex justify-center pointer-events-none">
                        <div class="timer-header-box pointer-events-auto">
                            <h1 id="training-title" class="text-xl font-bold text-white uppercase tracking-wider">Treino</h1>
                            <div id="workout-timer" class="digital-timer text-4xl">00:00:00</div>
                        </div>
                    </div>

                    <button id="save-training-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 rounded-lg text-xs flex items-center gap-1 shadow-lg relative z-10 active:scale-95 transition-transform">
                        <i data-feather="check-circle" class="w-4 h-4"></i>
                        <span>CONCLUIR</span>
                    </button>
                </header>
                <div class="h-24"></div> <!-- Spacer for header -->
                <div id="periodization-notification" class="hidden mb-4"></div>
                <div id="training-content-wrapper" class="space-y-3 pb-24"></div>
            </div>
            
            <!-- ======================= TELA DE PERIODIZAÇÃO ======================= -->
            <div id="periodizationScreen" class="screen p-6">
                <header class="flex items-center justify-between pt-6 pb-4">
                    <button class="back-btn p-2 rounded-full hover:bg-gray-800" data-target="studentProfileScreen"><i
                            data-feather="arrow-left" class="text-white"></i></button>
                    <h1 class="text-2xl font-bold text-white">Periodização</h1>
                    <div class="w-10"></div>
                </header>
                <div id="periodization-content-wrapper" class="space-y-4 pb-24"></div>
            </div>

            <!-- ======================= TELA DE ANÁLISE IA ======================= -->
            <div id="aiAnalysisScreen" class="screen p-6">
                <header class="flex items-center justify-between pt-6 pb-4">
                    <button class="back-btn p-2 rounded-full hover:bg-gray-800" data-target="studentProfileScreen">
                        <i data-feather="arrow-left" class="text-white"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-white">Análise de Performance</h1>
                    <div class="w-10"></div>
                </header>
                <div class="space-y-4 pb-24 text-center">
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg">
                        <i data-feather="cpu" class="w-16 h-16 mx-auto mb-4 text-teal-400"></i>
                        <h2 class="text-xl font-bold text-white mb-2">Análise com IA</h2>
                        <p class="text-sm mb-6">Receba insights sobre sua evolução de cargas e descubra pontos de melhoria.</p>
                        <button id="generate-analysis-btn" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 rounded-xl flex items-center justify-center space-x-2 transition shadow-lg">
                            <i data-feather="bar-chart-2"></i> <span>Gerar Análise</span>
                        </button>
                    </div>
            
                    <div id="ai-analysis-spinner" class="hidden text-center p-8">
                        <div class="loader inline-block"></div>
                        <p class="mt-4 text-white">Analisando seu progresso...</p>
                    </div>
            
                    <div id="ai-analysis-result" class="prose prose-invert max-w-none hidden text-left bg-gray-800 p-6 rounded-xl border border-gray-700 space-y-4"></div>
                </div>
            </div>

             <!-- ======================= TELA NUTRICIONISTA IA ======================= -->
            <div id="iaNutritionistScreen" class="screen">
                <div class="h-full flex flex-col p-0">
                    <header class="flex items-center justify-between pt-6 pb-4 px-6 flex-shrink-0">
                        <button class="back-btn p-2 rounded-full hover:bg-gray-800" data-target="studentProfileScreen">
                            <i data-feather="arrow-left" class="text-white"></i>
                        </button>
                        <h1 class="text-2xl font-bold text-white text-center">Consulta Nutricional IA</h1>
                        <div class="w-10"></div>
                    </header>
                    <div id="nutrition-content-wrapper" class="flex-grow overflow-y-auto"></div>
                </div>
            </div>


            <!-- ======================= TELA DE CORRIDA ======================= -->
            <div id="runningScreen" class="screen p-6">
                <header class="flex items-center justify-between pt-6 pb-4">
                    <button class="back-btn p-2 rounded-full hover:bg-gray-800" data-target="studentProfileScreen"><i
                            data-feather="arrow-left" class="text-white"></i></button>
                    <h1 class="text-2xl font-bold text-white">Treinos de Corrida</h1>
                    <div class="w-10"></div>
                </header>
                <div id="running-workouts-list" class="space-y-3 pb-24"></div>
            </div>

             <!-- ======================= TELA CALENDÁRIO DE CORRIDAS ======================= -->
            <div id="raceCalendarScreen" class="screen p-6">
                <header class="flex items-center justify-between pt-6 pb-4">
                    <button class="back-btn p-2 rounded-full hover:bg-gray-800" data-target="studentProfileScreen"><i
                            data-feather="arrow-left" class="text-white"></i></button>
                    <h1 class="text-2xl font-bold text-white">Provas de Corrida</h1>
                    <div class="w-10"></div>
                </header>
                <div class="bg-blue-900/50 text-blue-200 text-sm p-3 rounded-lg border border-blue-700 mb-4">
                    <p><strong>Aviso:</strong> Esta é uma lista de exemplo e pode não estar 100% atualizada. Sempre confirme os detalhes no site oficial do evento.</p>
                </div>
                <div id="race-calendar-list" class="space-y-4 pb-24"></div>
            </div>

            <!-- ======================= TELA DE EVOLUÇÃO ======================= -->
            <div id="evolutionScreen" class="screen p-6">
                <header class="flex items-center justify-between pt-6 pb-4">
                    <button class="back-btn p-2 rounded-full hover:bg-gray-800" data-target="studentProfileScreen"><i
                            data-feather="arrow-left" class="text-white"></i></button>
                    <h1 class="text-2xl font-bold text-white">Evolução de Carga</h1>
                    <div class="w-10"></div>
                </header>
                <div class="space-y-6 pb-24">
                    <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg">
                        <h2 class="text-xl font-bold text-white mb-2">Treino A</h2>
                        <label for="select-treino-a" class="text-sm text-white mb-2 block">Selecione o Exercício</label>
                        <select id="select-treino-a" class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg mb-4"></select>
                        <canvas id="treinoAChart" class="w-full"></canvas>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg">
                        <h2 class="text-xl font-bold text-white mb-2">Treino B</h2>
                         <label for="select-treino-b" class="text-sm text-white mb-2 block">Selecione o Exercício</label>
                        <select id="select-treino-b" class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg mb-4"></select>
                        <canvas id="treinoBChart" class="w-full"></canvas>
                    </div>
                </div>
            </div>

            <!-- ======================= TELA CONTROLE DE PESO ======================= -->
            <div id="weightControlScreen" class="screen p-6">
                <header class="flex items-center justify-between pt-6 pb-4">
                    <button class="back-btn p-2 rounded-full hover:bg-gray-800" data-target="studentProfileScreen"><i
                            data-feather="arrow-left" class="text-white"></i></button>
                    <h1 class="text-2xl font-bold text-white">Controle de Peso</h1>
                    <div class="w-10"></div>
                </header>
                <div class="space-y-4 pb-24">
                    <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg">
                        <h2 class="text-xl font-bold text-white mb-4">Adicionar Novo Registro</h2>
                        <div class="flex items-center gap-2">
                            <input type="number" step="0.1" id="weight-input" inputmode="decimal" placeholder="Ex: 85.5"
                                class="w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-lg">
                            <span class="font-semibold text-white">kg</span>
                            <button id="save-weight-btn"
                                class="bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors shadow-lg">Salvar</button>
                        </div>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg">
                        <h2 class="text-xl font-bold text-white mb-4">Evolução do Peso</h2>
                        <canvas id="weightChart" class="w-full"></canvas>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg">
                        <h2 class="text-xl font-bold text-white mb-4">Histórico de Peso</h2>
                        <div id="weight-history-list" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <!-- ======================= TELA AVALIAÇÃO FÍSICA ======================= -->
            <div id="physioAssessmentScreen" class="screen p-6">
                <header class="flex items-center pt-6 pb-4">
                    <button class="back-btn p-2 rounded-full hover:bg-gray-800" data-target="studentProfileScreen"><i
                            data-feather="arrow-left" class="text-white"></i></button>
                </header>
                 <header class="mb-8">
                    <h1 class="text-4xl font-bold text-white mb-2">
                        <i class="fas fa-dumbbell text-blue-400"></i> Avaliação Física
                    </h1>
                    <p class="text-gray-300">Sua plataforma de gestão de avaliações físicas.</p>
                    <nav class="mt-6 border-b border-gray-700">
                        <div class="flex space-x-8">
                            <button id="tab-professor" class="py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-500">Área do Professor</button>
                            <button id="tab-aluno" class="py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-400 hover:text-gray-300">Área do Aluno</button>
                        </div>
                    </nav>
                </header>

                <!-- Views -->
                <div id="view-professor" class="space-y-6">
                    <div id="professor-dashboard">
                         <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold text-white">Seus Alunos</h2>
                                <button id="btn-add-aluno" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center transition shadow-lg">
                                    <i class="fas fa-user-plus mr-2"></i> Novo Aluno
                                </button>
                            </div>
                            <div id="loader" class="text-center py-4"><i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i></div>
                            <div id="no-alunos-message" class="hidden text-center py-8 text-gray-400">
                                <i class="fas fa-users text-4xl mb-3 opacity-50"></i>
                                <p>Nenhum aluno cadastrado.</p>
                            </div>
                            <div id="lista-alunos" class="space-y-4 hidden"></div>
                        </div>
                    </div>

                    <div id="form-avaliacao" class="hidden bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg pb-32">
                        <div class="flex items-center mb-6">
                            <button id="btn-back-to-dashboard" class="mr-4 bg-gray-700 hover:bg-gray-600 p-2 rounded-full text-white"><i class="fas fa-arrow-left"></i></button>
                            <h2 class="text-2xl font-bold text-white">Nova Avaliação: <span id="form-aluno-nome" class="text-blue-400"></span></h2>
                        </div>
                        
                        <form id="avaliacao-form" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><label class="block text-gray-300 text-sm font-bold mb-2">Data</label><input type="date" id="data" required class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 text-white"></div>
                                <div><label class="block text-gray-300 text-sm font-bold mb-2">Peso (kg)</label><input type="number" step="0.1" id="peso" required class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 text-white"></div>
                                <div><label class="block text-gray-300 text-sm font-bold mb-2">Altura (cm)</label><input type="number" step="1" id="altura" required class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 text-white"></div>
                            </div>
                            
                            <h3 class="text-xl font-bold text-white border-b border-gray-700 pb-2 mt-6">Dobras Cutâneas (mm)</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="skinfold-inputs">
                                <div class="skinfold-field-wrapper" data-gender="Masculino Feminino"> <label class="block text-gray-400 text-xs mb-1">Coxa</label> <input type="number" step="0.1" id="dc_coxa" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div class="skinfold-field-wrapper" data-gender="Masculino"> <label class="block text-gray-400 text-xs mb-1">Peitoral</label> <input type="number" step="0.1" id="dc_peitoral" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div class="skinfold-field-wrapper" data-gender="Masculino"> <label class="block text-gray-400 text-xs mb-1">Abdominal</label> <input type="number" step="0.1" id="dc_abdominal" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div class="skinfold-field-wrapper" data-gender="Feminino"> <label class="block text-gray-400 text-xs mb-1">Tricipital</label> <input type="number" step="0.1" id="dc_tricipital" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div class="skinfold-field-wrapper" data-gender="Feminino"> <label class="block text-gray-400 text-xs mb-1">Suprailíaca</label> <input type="number" step="0.1" id="dc_suprailiaca" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                            </div>

                            <h3 class="text-xl font-bold text-white border-b border-gray-700 pb-2 mt-6">Perímetros (cm)</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div> <label class="block text-gray-400 text-xs mb-1">Tórax</label> <input type="number" step="0.1" id="p_torax" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Abdômen</label> <input type="number" step="0.1" id="p_abdomen" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Cintura</label> <input type="number" step="0.1" id="p_cintura" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Quadril</label> <input type="number" step="0.1" id="p_quadril" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Braço Dir.</label> <input type="number" step="0.1" id="p_braco_d" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Braço Esq.</label> <input type="number" step="0.1" id="p_braco_e" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Antebraço D</label> <input type="number" step="0.1" id="p_antebraco_d" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Antebraço E</label> <input type="number" step="0.1" id="p_antebraco_e" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Coxa Prox. D</label> <input type="number" step="0.1" id="p_coxa_proximal_d" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Coxa Prox. E</label> <input type="number" step="0.1" id="p_coxa_proximal_e" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Coxa Med. D</label> <input type="number" step="0.1" id="p_coxa_d" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Coxa Med. E</label> <input type="number" step="0.1" id="p_coxa_e" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Coxa Dist. D</label> <input type="number" step="0.1" id="p_coxa_distal_d" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Coxa Dist. E</label> <input type="number" step="0.1" id="p_coxa_distal_e" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Panturrilha D</label> <input type="number" step="0.1" id="p_panturrilha_d" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Panturrilha E</label> <input type="number" step="0.1" id="p_panturrilha_e" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                            </div>
                            
                            <h3 class="text-xl font-bold text-white border-b border-gray-700 pb-2 mt-6">Bioimpedância</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div> <label class="block text-gray-400 text-xs mb-1">Água Corp. (%)</label> <input type="number" step="0.1" id="bio_agua_corporal" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Proteína (%)</label> <input type="number" step="0.1" id="bio_proteina" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Minerais (%)</label> <input type="number" step="0.1" id="bio_minerais" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Massa Gordura (kg)</label> <input type="number" step="0.1" id="bio_massa_gordura" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Massa Magra (kg)</label> <input type="number" step="0.1" id="bio_massa_magra" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">TMB (kcal)</label> <input type="number" step="1" id="bio_tmb" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Gordura Visceral</label> <input type="number" step="1" id="bio_gordura_visceral" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                                <div> <label class="block text-gray-400 text-xs mb-1">Grau Obesidade (%)</label> <input type="number" step="0.1" id="bio_grau_obesidade" class="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white"> </div>
                            </div>

                            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl mt-8 shadow-lg text-lg">Salvar Avaliação</button>
                        </form>
                    </div>

                    <div id="view-aluno-data" class="hidden"></div>
                </div>

                <div id="view-aluno" class="hidden pb-24">
                    <div id="aluno-login-screen" class="text-center py-10">
                        <i class="fas fa-lock text-5xl text-gray-600 mb-4"></i>
                        <h2 class="text-2xl font-bold text-white mb-4">Acesso do Aluno</h2>
                        <p class="text-gray-400 mb-6">Selecione seu nome para ver seus resultados.</p>
                        <select id="aluno-selector" class="w-full max-w-md p-3 rounded-lg bg-gray-700 border border-gray-600 text-white mx-auto block"></select>
                    </div>
                    <div id="aluno-dashboard" class="hidden space-y-6"></div>
                </div>
            </div>

            <!-- ======================= TELA DE SELEÇÃO OUTDOOR ======================= -->
            <div id="outdoorSelectionScreen" class="screen p-6">
                <header class="flex items-center justify-between pt-6 pb-4">
                    <button class="back-btn p-2 rounded-full hover:bg-gray-800" data-target="studentProfileScreen"><i
                            data-feather="arrow-left" class="text-white"></i></button>
                    <h1 class="text-2xl font-bold text-white">Outdoor</h1>
                    <div class="w-10"></div>
                </header>
                
                <h2 class="text-xl font-bold text-white mb-6 text-center">Escolha sua atividade</h2>
                
                <div class="grid grid-cols-2 gap-4">
                    <button class="outdoor-activity-btn bg-gray-800 p-6 rounded-xl border border-gray-700 hover:border-red-500 transition group" data-activity="Corrida">
                        <i class="fas fa-running text-4xl text-orange-500 mb-3 group-hover:scale-110 transition-transform"></i>
                        <span class="block text-white font-bold">Corrida</span>
                    </button>
                    <button class="outdoor-activity-btn bg-gray-800 p-6 rounded-xl border border-gray-700 hover:border-red-500 transition group" data-activity="Caminhada">
                        <i class="fas fa-walking text-4xl text-green-500 mb-3 group-hover:scale-110 transition-transform"></i>
                        <span class="block text-white font-bold">Caminhada</span>
                    </button>
                    <button class="outdoor-activity-btn bg-gray-800 p-6 rounded-xl border border-gray-700 hover:border-red-500 transition group" data-activity="Ciclismo">
                        <i class="fas fa-biking text-4xl text-blue-500 mb-3 group-hover:scale-110 transition-transform"></i>
                        <span class="block text-white font-bold">Ciclismo</span>
                    </button>
                    <button class="outdoor-activity-btn bg-gray-800 p-6 rounded-xl border border-gray-700 hover:border-red-500 transition group" data-activity="Outro">
                        <i class="fas fa-bolt text-4xl text-yellow-500 mb-3 group-hover:scale-110 transition-transform"></i>
                        <span class="block text-white font-bold">Livre</span>
                    </button>
                </div>
            </div>

            <!-- ======================= TELA DE RASTREAMENTO OUTDOOR ======================= -->
            <div id="outdoorTrackingScreen" class="screen">
                <div class="h-full flex flex-col p-0 relative">
                    <!-- Map Area (Top Half) -->
                    <div id="map" class="w-full h-[55vh] z-0 bg-gray-900"></div>
                    
                    <!-- Controls Area (Bottom Half - Overlay) -->
                    <div class="bg-gray-900 rounded-t-3xl -mt-6 relative z-10 flex-1 flex flex-col p-6 shadow-2xl border-t border-gray-700">
                        <!-- Handle bar visual -->
                        <div class="w-12 h-1 bg-gray-700 rounded-full mx-auto mb-4"></div>
                        
                        <div class="flex justify-between items-center mb-6">
                            <button class="outdoor-back-btn p-2 rounded-full bg-gray-800 text-gray-400 hover:text-white" data-target="outdoorSelectionScreen">
                                <i data-feather="x"></i>
                            </button>
                            <h2 id="tracking-activity-title" class="text-xl font-black text-white uppercase tracking-wider">ATIVIDADE</h2>
                            <div class="w-10"></div>
                        </div>

                        <!-- Stats Grid -->
                        <div class="grid grid-cols-2 gap-4 mb-8">
                            <div class="bg-gray-800 p-4 rounded-2xl border border-gray-700 text-center">
                                <p class="text-xs text-gray-400 uppercase font-bold tracking-wider mb-1">Distância</p>
                                <p id="tracking-distance" class="text-3xl font-black text-white font-mono">0.00 km</p>
                            </div>
                            <div class="bg-gray-800 p-4 rounded-2xl border border-gray-700 text-center">
                                <p class="text-xs text-gray-400 uppercase font-bold tracking-wider mb-1">Tempo</p>
                                <p id="tracking-time" class="text-3xl font-black text-white font-mono">00:00:00</p>
                            </div>
                            <div class="col-span-2 bg-gray-800 p-3 rounded-xl border border-gray-700 flex justify-between items-center px-6">
                                <span class="text-xs text-gray-400 uppercase font-bold">Ritmo Médio</span>
                                <span id="tracking-pace" class="text-xl font-bold text-orange-500 font-mono">--:-- /km</span>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="mt-auto flex justify-center gap-4">
                            <button id="start-tracking-btn" class="w-20 h-20 rounded-full bg-green-600 hover:bg-green-500 flex items-center justify-center shadow-lg shadow-green-900/50 transition-transform active:scale-95">
                                <i class="fas fa-play text-2xl text-white ml-1"></i>
                            </button>
                            
                            <button id="pause-tracking-btn" class="hidden w-20 h-20 rounded-full bg-yellow-600 hover:bg-yellow-500 flex items-center justify-center shadow-lg shadow-yellow-900/50 transition-transform active:scale-95">
                                <i class="fas fa-pause text-2xl text-white"></i>
                            </button>
                            
                            <button id="stop-tracking-btn" class="hidden w-20 h-20 rounded-full bg-red-600 hover:bg-red-500 flex items-center justify-center shadow-lg shadow-red-900/50 transition-transform active:scale-95">
                                <i class="fas fa-stop text-2xl text-white"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- ======================= MODAIS ======================= -->
    
    <!-- Modal Detalhes Exercício -->
    <div id="exerciseDetailModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div id="exercise-modal-content" class="bg-gray-800 rounded-2xl w-full max-w-md overflow-hidden shadow-2xl transform transition-all scale-95 opacity-0 duration-200 border border-gray-700">
            <div class="relative h-64 bg-gray-900">
                <img id="modal-exercise-img" src="" class="w-full h-full object-cover opacity-90">
                <div class="absolute inset-0 bg-gradient-to-t from-gray-900 to-transparent"></div>
                <button id="closeExerciseModalBtn" class="absolute top-4 right-4 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 backdrop-blur-sm">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
                <div class="absolute bottom-4 left-4 right-4">
                    <span class="text-xs font-bold text-red-500 uppercase tracking-wider bg-black/60 px-2 py-1 rounded mb-2 inline-block">Detalhes</span>
                    <h3 id="modal-exercise-name" class="text-2xl font-black text-white leading-tight"></h3>
                </div>
            </div>
            <div class="p-6">
                <div class="flex items-center gap-3 text-gray-300 mb-4">
                    <i data-feather="info" class="w-5 h-5 text-blue-400"></i>
                    <p class="text-sm">Realize o movimento com controle e foco na contração muscular.</p>
                </div>
                <button class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl shadow-lg transition" onclick="document.getElementById('closeExerciseModalBtn').click()">
                    Entendido
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes Periodização -->
    <div id="periodizationDetailModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div id="periodization-modal-content" class="bg-gray-800 rounded-2xl w-full max-w-md overflow-hidden shadow-2xl transform transition-all scale-95 opacity-0 duration-200 border border-gray-700">
            <div class="p-6 border-b border-gray-700 flex justify-between items-start bg-gray-900/50">
                <div>
                    <h3 id="modal-periodization-phase" class="text-2xl font-black text-white mb-1"></h3>
                    <div id="modal-periodization-dates" class="text-sm text-gray-400 flex items-center gap-2"></div>
                </div>
                <button id="closePeriodizationModalBtn" class="bg-gray-700/50 text-gray-400 p-2 rounded-full hover:text-white">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="modal-periodization-goal" class="text-lg font-bold text-white mb-4 flex items-center gap-2 bg-gray-700/30 p-3 rounded-lg border border-gray-600/50"></div>
                
                <div id="modal-periodization-details"></div>

                <div class="mt-6 pt-4 border-t border-gray-700">
                     <p class="text-[10px] text-gray-500 text-center uppercase tracking-widest font-bold">Diretrizes do Treinador</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Adicionar Aluno (Avaliação) -->
    <div id="modal-add-aluno" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div id="modal-content" class="bg-gray-800 rounded-xl w-full max-w-md p-6 transform scale-95 opacity-0 transition-all duration-300 shadow-2xl border border-gray-700">
            <h3 class="text-xl font-bold text-white mb-4">Novo Aluno</h3>
            <form id="form-novo-aluno" class="space-y-4">
                <div>
                    <label class="block text-gray-400 text-sm mb-1">Nome Completo</label>
                    <input type="text" id="nome-aluno" required class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-gray-400 text-sm mb-1">Data de Nascimento</label>
                    <input type="date" id="nascimento-aluno" required class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-gray-400 text-sm mb-1">Sexo Biológico</label>
                    <select id="sexo-aluno" required class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:border-blue-500 outline-none">
                        <option value="Masculino">Masculino</option>
                        <option value="Feminino">Feminino</option>
                    </select>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" id="btn-cancel-modal" class="flex-1 py-3 bg-gray-700 text-gray-300 rounded-lg font-bold hover:bg-gray-600">Cancelar</button>
                    <button type="submit" class="flex-1 py-3 bg-green-600 text-white rounded-lg font-bold hover:bg-green-500 shadow-lg">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ======================= NEW: MODAL FINALIZAR TREINO (SELFIE) ======================= -->
    <div id="finishWorkoutModal" class="fixed inset-0 z-[60] hidden flex flex-col items-center justify-center bg-black/95 backdrop-blur-md p-6">
        <div class="w-full max-w-md bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <!-- Header -->
            <div class="p-6 text-center border-b border-gray-800">
                <i data-feather="check-circle" class="w-12 h-12 text-green-500 mx-auto mb-3"></i>
                <h2 class="text-2xl font-black text-white uppercase tracking-wider">Treino Finalizado!</h2>
                <p class="text-gray-400 text-sm mt-1">Ótimo trabalho hoje.</p>
            </div>
            
            <!-- Content -->
            <div class="p-6 flex-1 overflow-y-auto">
                <!-- Summary Stats -->
                <div id="finish-modal-summary" class="bg-gray-800/50 rounded-xl p-4 mb-6 border border-gray-700">
                    <!-- Populated via JS -->
                </div>

                <!-- Photo Section -->
                <div class="mb-2">
                     <p class="text-white text-sm font-bold mb-3 text-center">Registrar esse momento (Opcional)</p>
                     <div class="relative w-full aspect-square bg-gray-800 rounded-xl border-2 border-dashed border-gray-600 flex flex-col items-center justify-center overflow-hidden group hover:border-gray-400 transition cursor-pointer" onclick="document.getElementById('workout-photo-input').click()">
                         
                         <!-- Placeholder -->
                         <div id="finish-photo-placeholder" class="text-center p-4">
                             <div class="w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-2 group-hover:bg-gray-600 transition">
                                 <i data-feather="camera" class="w-8 h-8 text-gray-300"></i>
                             </div>
                             <span class="text-xs text-gray-400 font-medium">Toque para adicionar foto</span>
                         </div>

                         <!-- Preview Image -->
                         <img id="finish-photo-preview" class="absolute inset-0 w-full h-full object-cover hidden">
                     </div>
                     <input type="file" id="workout-photo-input" accept="image/*" capture="environment" class="hidden" onchange="handlePhotoSelect(event)">
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="p-4 bg-gray-800 border-t border-gray-700 flex flex-col gap-3">
                <button onclick="saveFinishedWorkout()" class="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-black rounded-xl text-lg shadow-lg flex items-center justify-center gap-2">
                    <span>SALVAR TREINO</span>
                    <i data-feather="arrow-right" class="w-5 h-5"></i>
                </button>
                 <button onclick="document.getElementById('finishWorkoutModal').classList.add('hidden')" class="w-full py-3 text-gray-500 hover:text-white font-bold text-sm">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- ======================= NEW: MODAL DETALHES DO HISTÓRICO (VER FOTO) ======================= -->
    <div id="workoutResultModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm p-4">
        <div class="bg-gray-800 rounded-2xl w-full max-w-sm overflow-hidden shadow-2xl border border-gray-700">
            <div class="relative">
                <img id="history-modal-img" class="w-full h-64 object-cover bg-gray-900 hidden">
                <div id="history-modal-no-img" class="w-full h-32 bg-gray-900 flex items-center justify-center text-gray-600 hidden">
                    <span class="text-xs">Sem foto</span>
                </div>
                <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent"></div>
                <button onclick="document.getElementById('workoutResultModal').classList.add('hidden')" class="absolute top-3 right-3 bg-black/50 text-white p-2 rounded-full backdrop-blur-md">
                    <i data-feather="x" class="w-4 h-4"></i>
                </button>
            </div>
            <div class="p-6 -mt-4 relative">
                <div class="flex justify-between items-end mb-2">
                    <h3 id="history-modal-type" class="text-2xl font-black text-white uppercase leading-none">TREINO A</h3>
                    <span id="history-modal-date" class="text-xs text-gray-400 font-mono bg-gray-900 px-2 py-1 rounded border border-gray-700">2023-10-10</span>
                </div>
                
                <div class="grid grid-cols-2 gap-3 mt-4">
                    <div class="bg-gray-700/50 p-3 rounded-lg border border-gray-600">
                        <p class="text-[10px] text-gray-400 uppercase font-bold">Tempo</p>
                        <p id="history-modal-duration" class="text-lg font-bold text-white font-mono">00:00:00</p>
                    </div>
                     <div id="history-modal-distance-box" class="bg-gray-700/50 p-3 rounded-lg border border-gray-600 hidden">
                        <p class="text-[10px] text-gray-400 uppercase font-bold">Distância</p>
                        <p id="history-modal-distance" class="text-lg font-bold text-white font-mono">0.00 km</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="index.js"></script>
    <script src="assessment.js"></script>
    
    <!-- Failsafe: Hide splash if JS errors out -->
    <script>
        setTimeout(() => {
            const splash = document.getElementById('splashScreen');
            const app = document.getElementById('appContainer');
            if(splash && !splash.classList.contains('hidden') && app.classList.contains('init-hidden')) {
                console.warn("Failsafe triggered: Hiding splash screen due to timeout.");
                splash.classList.add('hidden');
                app.classList.remove('hidden');
                app.classList.remove('init-hidden');
                document.getElementById('loginScreen').style.display = 'block';
            }
        }, 2200);
    </script>
</body>
</html>